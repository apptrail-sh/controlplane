spring:
  application:
    name: controlplane
  ai:
    openai:
      api-key: ${OPENAI_API_KEY:}
      chat:
        options:
          model: ${AI_MODEL:gpt-5.2}
          temperature: ${AI_TEMPERATURE:0.7}
  profiles:
    include:
      - queries
  datasource:
    driver-class-name: org.postgresql.Driver
    url: jdbc:postgresql://localhost:5432/apptrail
    username: apptrail
    password: apptrail
  docker:
    compose:
      lifecycle-management: start-only
  cloud:
    gcp:
      pubsub:
        enabled: ${PUBSUB_ENABLED:false}

app:
  clusters:
    # Unified cluster definitions
    # Example configuration:
    # definitions:
    #   cluster-staging-gke-usce1:
    #     environment: staging
    #     alias: stg.01
    #     shard:
    #       name: canary
    #       order: 0
    #     namespaces:  # Optional namespace-level shard overrides
    #       special-ns:
    #         shard:
    #           name: shard02
    #           order: 2
    # definitions: {}  # Removed - let profile-specific config provide this
    environments:
      - name: dev
        order: 0
      - name: staging
        order: 1
      - name: production
        order: 2
  ingest:
    http:
      enabled: true
    pubsub:
      enabled: ${PUBSUB_ENABLED:false}
      subscription: ${PUBSUB_SUBSCRIPTION:}
    team-label: team
  gitprovider:
    github:
      enabled: ${GITHUB_APP_ENABLED:false}
      app-id: ${GITHUB_APP_ID:}
      private-key-path: ${GITHUB_APP_PRIVATE_KEY_PATH:}
      private-key-base64: ${GITHUB_APP_PRIVATE_KEY_BASE64:}
      api-base-url: ${GITHUB_API_BASE_URL:https://api.github.com}
  release-fetch:
    enabled: true
    interval-ms: ${RELEASE_FETCH_INTERVAL_MS:30000}
  cors:
    allowed-origins:
      - "http://localhost:5173"
      - "http://localhost:3000"
    allowed-methods:
      - "GET"
      - "POST"
      - "PUT"
      - "PATCH"
      - "DELETE"
      - "OPTIONS"
    allowed-headers:
      - "*"
    allow-credentials: false
    max-age: 3600
  alerting:
    prometheus:
      enabled: ${PROMETHEUS_ENABLED:false}
      base-url: ${PROMETHEUS_BASE_URL:http://localhost:8481}
      query-path: ${PROMETHEUS_QUERY_PATH:/select/0:0/prometheus/api/v1/query}
      timeout-ms: ${PROMETHEUS_TIMEOUT_MS:5000}
      cache:
        enabled: true
        ttl-seconds: 30

server:
  port: 3000

apptrail:
  ai:
    enabled: ${AI_ENABLED:false}
    model: ${AI_MODEL:gpt-4o-mini}
    max-tokens: ${AI_MAX_TOKENS:2048}
    temperature: ${AI_TEMPERATURE:0.7}
  quick-links:
    links:
      - name: "GCP Logs"
        description: "View logs in Google Cloud Console"
        urlTemplate: "https://console.cloud.google.com/logs/query;query=resource.labels.cluster_name%3D%22{{cluster.name}}%22%0Aresource.labels.namespace_name%3D%22{{instance.namespace}}%22;project={{environment.metadata.gcp-project}}"
        linkType: url
        icon: gcp
      - name: "Grafana Dashboard"
        description: "View metrics in Grafana"
        urlTemplate: "https://grafana.example.com/d/k8s?var-namespace={{instance.namespace}}&var-workload={{workload.name}}"
        linkType: url
        icon: grafana
      - name: "kubectl describe"
        description: "Describe the workload pods"
        urlTemplate: "kubectl --context=$(kubectl config get-contexts -o name | grep -i '{{cluster.name}}' | head -1) -n {{instance.namespace}} describe {{workload.kind | lowercase}}/{{workload.name}}"
        linkType: command
        icon: terminal
